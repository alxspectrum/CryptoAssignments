## EVP Operations

### Description 
This software implements the following operations using the EVP API in C: 
* Key generation
* Encrypt file contents using AES ECB
* Decrypt file contents using AES ECB
* Sign a file with CMAC 
* Verify a signed file with CMAC

Encryption and decryption is available for bit modes 128 and 256.

### !Disclaimer 
This software is for auditing purposes only as it has not 
been tested on many different scenarios and security vulnerabilities. 
Cryptographic software demands high levels of expertise and 
security optimization for production. 

##### Key generation
A cryptographic key is generated by the hash function SHA1 
using the EVP function ``` EVP_digest() ``` for 128 and 256 bits.
SHA1 returns at most 20 bytes so for 256 bit mode the last 12 bytes
are padded with zeros.

##### Encrypt
The encryption operations follows the latest EVP functions using AES ECB: 
* ``` EVP_EncryptInit() ```: Initialize the cipher context
* ``` EVP_EncryptUpdate() ```: Encrypt the data up to the last block - 1
* ``` EVP_EncryptFinal_ex() ```: Finalize the operation encrypting the remaining bytes
The ciphertext is stored in an output file and the size is the next multiple of BLOCK_SIZE
of the data length

##### Decrypt
The decryption operations follows the latest EVP functions using AES ECB: 
* ``` EVP_DecryptInit() ```: Initialize the cipher context
* ``` EVP_DecryptUpdate() ```: Decrypt the data up to the last block - 1
* ``` EVP_DecryptFinal_ex() ```: Finalize the operation decrypting the remaining bytes
The plaintext is stored in an output file and the size is the next multiple of BLOCK_SIZE
of the data length. The padding is removed from the output text.

##### Sign
The signing operation concatenates a CMAC of the data on the encrypted data.
The CMAC is generated using the CMAC API and AES ECB:
* ``` CMAC_Init ```: Initialize the CMAC operation
* ``` CMAC_Update ```: Generate the CMAC of the data 
* ``` CMAC_Final ```: Finalize the operation
The CMAC size is 16 bytes.

##### Verify
To verify the data we follow the steps:
* Separate ciphertext and CMAC
* Decrypt the ciphertext 
* Generate CMAC of the decrypted data
* Compare the provided CMAC with the generated CMAC
The signature is verified if CMACs are equal.

##### Results
The software correctly encrypts, decrypts, signs, verifies,
except for the verification of the file hpy414_verifyme_256.txt.
The file hpy414_verifme_128.txt is not verified, as the CMACs
are different.

##### Known bugs
**Signing and verifying the signme_128.txt works for 
both 128 and 256 modes**, but on verifying the file 
hpy414_verifyme_256.txt the program fails on the
EVP_DecryptFinal_ex(), so we cannot generate the CMAC
to compare. 

Since the file is given, a possible cause 
could be a version difference.

